<!DOCTYPE html>
<!-- saved from url=(0069)https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>How to get data from MongoDB into Node.js</title>
    <meta name="description" content="Use the Node.js native driver to retrieve data from a MongoDB database, and return it to a website in a useful and usable way.">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="https://theholmesoffice.com/favicon.ico">

    <link rel="stylesheet" type="text/css" href="https://theholmesoffice.com/assets/css/screen.css?v=394907ec8f">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400">

    <link rel="canonical" href="https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/amp/">
    
    <meta property="og:site_name" content="The Holmes Office">
    <meta property="og:type" content="article">
    <meta property="og:title" content="How to get data from MongoDB into Node.js">
    <meta property="og:description" content="Use the Node.js native driver to retrieve data from a MongoDB database, and return it to a website in a useful and usable way.">
    <meta property="og:url" content="https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/">
    <meta property="article:published_time" content="2012-09-28T06:50:30.000Z">
    <meta property="article:modified_time" content="2015-02-13T21:41:40.000Z">
    <meta property="article:tag" content="mongodb">
    <meta property="article:tag" content="node.js">
    <meta property="article:tag" content="nodejs">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="How to get data from MongoDB into Node.js">
    <meta name="twitter:description" content="Use the Node.js native driver to retrieve data from a MongoDB database, and return it to a website in a useful and usable way.">
    <meta name="twitter:url" content="https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Simon Holmes">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="mongodb, node.js, nodejs">
    <meta name="twitter:site" content="@simonholmes">
    
    <script async="" src="./How to get data from MongoDB into Node.js_files/analytics.js.download"></script><script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "The Holmes Office",
        "logo": "https://theholmesoffice.com/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Simon Holmes",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/c7c7b1183ec1ce69e4568935a585c1db?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://theholmesoffice.com/author/simon/",
        "sameAs": [
            "http://www.fullstacktraining.com"
        ],
        "description": "Author of &quot;Getting MEAN&quot; and &quot;Mongoose for Application Development&quot;. Lover of JavaScript development.\nFounder of Full Stack Training."
    },
    "headline": "How to get data from MongoDB into Node.js",
    "url": "https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/",
    "datePublished": "2012-09-28T06:50:30.000Z",
    "dateModified": "2015-02-13T21:41:40.000Z",
    "keywords": "mongodb, node.js, nodejs",
    "description": "Use the Node.js native driver to retrieve data from a MongoDB database, and return it to a website in a useful and usable way.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://theholmesoffice.com"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11">
    <link rel="alternate" type="application/rss+xml" title="The Holmes Office" href="https://theholmesoffice.com/rss/">
    <link rel="stylesheet" href="http://theholmesoffice.com.s3-eu-west-1.amazonaws.com/assets/prism.02.css">
<script type="text/javascript" async="" src="./How to get data from MongoDB into Node.js_files/embed.js.download"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.3999ac261b914f8b8b5e85df0ff3eaea.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.5f8e47303ecf1055cd7c6905466d140a.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.33067ddbd4792de0b384ceb588602715.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./How to get data from MongoDB into Node.js_files/alfalfa.4a5fcca1fe50a757044dfd331b660625.js.download" async="" charset="UTF-8"></script></head>
<body class="post-template tag-mongodb tag-node-js tag-nodejs">

    


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="https://theholmesoffice.com/">Home</a>
        <a class="subscribe-button icon-feed" href="https://theholmesoffice.com/rss/">Subscribe</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-mongodb tag-node-js tag-nodejs">

        <header class="post-header">
            <h1 class="post-title">How to get data from MongoDB into Node.js</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2012-09-28">28 September 2012</time>  on <a href="https://theholmesoffice.com/tag/mongodb/">mongodb</a>, <a href="https://theholmesoffice.com/tag/node-js/">node.js</a>, <a href="https://theholmesoffice.com/tag/nodejs/">nodejs</a>
            </section>
        </header>

        <section class="post-content">
            <p>So you’ve got a&nbsp;Node.js website, and&nbsp;created a MongoDB database&nbsp;- the big question – how do you connect the two? When we&nbsp;<a href="http://theholmesoffice.com/how-to-install-mongodb-on-ubuntu-for-node-js/" title="How to install MongoDB on Ubuntu for Node.js">installed MongoDB</a>&nbsp;we also installed&nbsp;the native MongoDB drivers for Node.js, so that’s a good start!</p>

<blockquote>
  <p>If you have just arrived at this page, and want the context and framework for the rest of the files, check out my posts&nbsp;<a href="http://theholmesoffice.com/getting-ready-for-scalability-creating-an-mvc-framework-for-our-node-js-page/" title="Creating an MVC framework for our Node.js page – getting ready for scalability">Creating an MVC framework for our Node.js page – getting ready for scalability</a>&nbsp;and&nbsp;<a href="http://theholmesoffice.com/how-to-create-a-mongodb-database/" title="How to create a MongoDB database">How to create a MongoDB database</a></p>
</blockquote>

<p>In the MVC approach we will need to look at the ‘model’ code and the ‘controller’ code.</p>

<h2 id="makeyourcodenonblocking">Make your code ‘non-blocking’</h2>

<p>We will start off by looking at the controller. In a traditional stack you say:</p>

<ol>
<li>I’m going to go and get the data from the database  </li>
<li>When I’ve got it I will do this with it</li>
</ol>

<p>This is no good for Node.js as it is a ‘blocking’ operation – nothing else can happen until you have the data back. This is essentially what we did in the MVC framework with this bit of code in <em>home.js</em>.</p>

<pre><code class="language-javascript">var teamlist = test_data.teamlist;  
var strTeam = "",  
  i = 0;
for (i = 0; i &lt; teamlist.count;) {  
  strTeam = strTeam + "&lt;li&gt;" + teamlist.teams[i].country + "&lt;/li&gt;";
  i = i + 1;
}
</code></pre>

<p>`
In that particular instance it was correct to do it this way, as we knew that the data-retrieval operation was non-blocking – we instantly pushed back a JSON object into the&nbsp;teamlist variable.</p>

<p>As pulling data from a database is a ‘blocking’ operation we need to handle it differently. We need to say:</p>

<ol>
<li>Go get this data from the database  </li>
<li>When you’ve got it, do this with it  </li>
<li>Don’t disturb me until you’re done, I’ve got other things to do</li>
</ol>

<p>Sound like a callback function to you? It does to me!</p>

<h2 id="creatingthecontroller">Creating the controller</h2>

<p>So let’s take a look at the new controller code and see what’s going on. I have created a new file for this, called&nbsp;<em>home-mongo.js</em>.</p>

<pre><code class="language-javascript">var template = require('../views/template-main');  
var mongo_data = require('../model/mongo-data');  
exports.get = function(req, res) {  
  mongo_data.teamlist("D", function(err, teamlist) {
    if (!err) {
      var strTeam = "",
        i = 0;
      for (i = 0; i &lt; teamlist.count;) {
        strTeam = strTeam + "&lt;li&gt;" + teamlist.teams[i].country + "&lt;/li&gt;";
        i = i + 1;
      }
      strTeam = "&lt;ul&gt;" + strTeam + "&lt;/ul&gt;";
      res.writeHead(200, {
        'Content-Type': 'text/html'
      });
      res.write(template.build("Test web page on node.js", "Hello there", "&lt;p&gt;The teams in Group " + teamlist.GroupName + " for Euro 2012 are:&lt;/p&gt;" + strTeam));
      res.end();
    } else {
      res.writeHead(200, {
        'Content-Type': 'text/html'
      });
      res.write(template.build("Oh dear", "Database error", "&lt;p&gt;Error details: " + err + "&lt;/p&gt;"));
      res.end();
    }
  });
};
</code></pre>

<p>This is very similar to our&nbsp;*home.js&nbsp;*file, just a few important differences.</p>

<p>Firstly, we ‘require’ a different model file,&nbsp;<em>mongo-data.js</em>&nbsp;that we will look at shortly.</p>

<p>Secondly, rather than pulling the data and doing something with it, we are using a callback function to say “do this with the data when you’ve got it”. What we are doing with the data is exactly the same as before. Note that we are sending the string “D” through as a variable; this is the string we will be searching for in the database.</p>

<p>Thirdly, through the callback function we are also sending instructions for what to do if an error occurs getting the data.</p>

<h2 id="usingnodejstoquerythemongodbdata">Using Node.js to query the MongoDB data</h2>

<p>Before we look at the code, let’s think about what we’re looking to achieve:</p>

<ol>
<li>Connect to the MongoDB database  </li>
<li>Have a function that is expecting a string variable and a callback  </li>
<li>Search the database for the variable (a specific key of ‘GroupName’)  </li>
<li>Create a JSON object if successful  </li>
<li>Catch the error if not successful  </li>
<li>Pass the JSON object or the error to the provided callback function  </li>
<li>Close the database connection</li>
</ol>

<p>Easy? Not as hard as you might think. So here’s the code for the&nbsp;*mongo-data.js&nbsp;*file:</p>

<pre><code class="language-javascript">var mongo = require('mongodb'),  
  Server = mongo.Server,
  Db = mongo.Db;
var server = new Server('localhost', 27017, {  
  auto_reconnect: true
});
var db = new Db('euro2012', server);  
var onErr = function(err, callback) {  
  db.close();
  callback(err);
};
exports.teamlist = function(gname, callback) {  
  db.open(function(err, db) {
    if (!err) {
      db.collection('teams', function(err, collection) {
        if (!err) {
          collection.find({
            'GroupName': gname
          }).toArray(function(err, docs) {
            if (!err) {
              db.close();
              var intCount = docs.length;
              if (intCount &gt; 0) {
                var strJson = "";
                for (var i = 0; i &lt; intCount;) {
                  strJson += '{"country":"' + docs[i].country + '"}'
                  i = i + 1;
                  if (i &lt; intCount) {
                    strJson += ',';
                  }
                }
                strJson = '{"GroupName":"' + gname + '","count":' + intCount + ',"teams":[' + strJson + "]}"
                callback("", JSON.parse(strJson));
              }
            } else {
              onErr(err, callback);
            }
          }); //end collection.find 
        } else {
          onErr(err, callback);
        }
      }); //end db.collection
    } else {
      onErr(err, callback);
    }
  }); // end db.open
};
</code></pre>

<p>The first five lines are all about setting up the MondoDB server and connecting to our database. You can learn more about that on the <a href="http://mongodb.github.com/node-mongodb-native/api-articles/nodekoarticle1.html" title="MongoDB Native driver info">MongoDB Native Driver GitHub page</a>.</p>

<p>Then we have a function&nbsp;<em>onErr</em> that we will call if we catch an error at any point.</p>

<p>Now comes the fun part! The MongoDB Native driver comes with a number of non-blocking functions built in. We are using three, to:</p>

<ol>
<li>Open our database (db.open)  </li>
<li>Find the ‘collection’ we specify (db.collection)  </li>
<li>Find the documents in that collection that match the query we specify (collection.find().toArray)</li>
</ol>

<p>These all run as nested callbacks, which is where the code can get tricky to follow. To help with this I recommend adding a comment at the end of each callback function, like you can see in the code.</p>

<p>Counter-intuitively, the <em>collection.find</em> method doesn’t actually execute the query, that’s done by the&nbsp;<em>toArray</em> method. So that’s where we pass our next callback function. This part is where we take the&nbsp;<em>docs</em> returned by the database and use them to create a JSON object in the format we want.</p>

<p>The finished JSON object should look like this:</p>

<pre><code class="language-javascript">{
  "GroupName": "D",
  "count": 4,
  "teams": [{
    "country": "England"
  }, {
    "country": "France"
  }, {
    "country": "Sweden"
  }, {
    "country": "Ukraine"
  }]
}
</code></pre>

<p>When the JSON object is complete we finally use the callback function, sending the object through.</p>

<p>The last thing we need to do – if you’ve been playing along at home – is update our router file to call the controller.</p>

<p>So in&nbsp;<em>router.js</em> file just change the home controller to be home-mongo, like so:</p>

<pre><code class="language-javascript">if (path === '/' || path === '/home') {  
  require('./controllers/home-mongo').get(req, res);
}
</code></pre>

<p>If you run the site, you shouldn’t really see any change, as all of the data manipulation is happening behind the scenes. <br>
<img src="http://res.cloudinary.com/the-holmes-office/image/upload/v1422032006/Screenshot-from-2012-09-28-074024_waix1g.png" node.js="" website="" pulling="" data="" from="" mongodb""="" alt=""></p>

<p>Next up we’ll see if we can simplify this process by <a href="http://theholmesoffice.com/mongoose-and-node-js-tutorial/" title="Mongoose and Node.js tutorial">using Mongoose, Node.js and MongoDB together</a>.</p>

<blockquote>
  <p><strong>Get the source code</strong></p>
  
  <p><em>*</em>*The source code for this and my other tutorials on Node.js is available on GitHub here:&nbsp;<a href="https://github.com/simonholmes/knowing-node/" title="Knowing Node source code on GitHub">https://github.com/simonholmes/knowing-node/</a></p>
</blockquote>
            <div id="disqus_thread"><iframe id="dsq-app2046" name="dsq-app2046" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./How to get data from MongoDB into Node.js_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 562px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'theholmesoffice'; // required: replace example with your forum shortname

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="<a class="vglnk" href="https://disqus.com/?ref_noscript" rel="nofollow"><span>https</span><span>://</span><span>disqus</span><span>.</span><span>com</span><span>/?</span><span>ref</span><span>_</span><span>noscript</span></a>">comments powered by Disqus.</a></noscript>
            
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="https://theholmesoffice.com/author/simon/" style="background-image: url(//www.gravatar.com/avatar/c7c7b1183ec1ce69e4568935a585c1db?s=250&amp;d=mm&amp;r=x)"><span class="hidden">Simon Holmes's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="https://theholmesoffice.com/author/simon/">Simon Holmes</a></h4>

                    <p>Author of "Getting MEAN" and "Mongoose for Application Development". Lover of JavaScript development.
Founder of Full Stack Training.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">UK</span>
                    <span class="author-link icon-link"><a href="http://www.fullstacktraining.com/">http://www.fullstacktraining.com</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=How%20to%20get%20data%20from%20MongoDB%20into%20Node.js&amp;url=https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/" onclick="window.open(this.href, &#39;twitter-share&#39;, &#39;width=550,height=235&#39;);return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/" onclick="window.open(this.href, &#39;facebook-share&#39;,&#39;width=580,height=296&#39;);return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://theholmesoffice.com/how-to-ge-data-from-mongodb-into-node-js/" onclick="window.open(this.href, &#39;google-plus-share&#39;, &#39;width=490,height=530&#39;);return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="https://theholmesoffice.com/">The Holmes Office</a> © 2018</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org/">Ghost</a></section>
    </footer>

    <!-- You can safely delete this line if your theme does not require jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<script src="http://theholmesoffice.com.s3.amazonaws.com/assets/prism.02.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33723083-1', 'auto');
  ga('send', 'pageview');

</script>

    <script type="text/javascript" src="./How to get data from MongoDB into Node.js_files/jquery.fitvids.js.download"></script>
    <script type="text/javascript" src="./How to get data from MongoDB into Node.js_files/index.js.download"></script>



<iframe style="display: none;" src="./How to get data from MongoDB into Node.js_files/saved_resource(1).html"></iframe></body></html>