if (self.CavalryLogger) { CavalryLogger.start_js(["7z38z"]); }

__d("MessengerGraphQLThreadlistFetcher.bs",["Promise","bs_array","bs_js_dict","BanzaiODS","bs_caml_array","WebGraphQL","bs_caml_format","CurrentUser","MessengerServerPayloadTransformer.bs","MessengerThreadlistWebGraphQLQuery"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return new(b("MessengerThreadlistWebGraphQLQuery"))({limit:a.limit,before:a.timestamp,tags:a.tags,isWorkUser:b("CurrentUser").isWorkUser(),includeDeliveryReceipts:a.includeDeliveryReceipts,includeSeqID:a.includeSeqID})}function h(a,c,d,e){__p&&__p();var f=[],g=[],h={},i=[],j={},k=[undefined],l=[0];b("bs_array").iteri(function(e,m){__p&&__p();e=b("bs_caml_array").caml_array_get(c,e);var n=[],o=[],p=[],q=m.viewer.pending_threads;q==null||(l[0]=q.unseen_count);b("bs_array").iter(function(c){__p&&__p();if(c==null)return 0;else{var e=b("MessengerServerPayloadTransformer.bs").transformThread(a,c,d),g=b("MessengerServerPayloadTransformer.bs").transformParticipants(c);b("bs_array").iter(function(a){j[a.fbid]=a;return 0},g);var k;if(e.is_canonical){g=e.other_user_fbid;g==null?k=null:(n.push(g),k=g)}else{g=e.thread_fbid;g==null?k=null:(o.push(g),k=g)}p.push(e.thread_id);f.push(e);if(!(k==null)){g=b("MessengerServerPayloadTransformer.bs").transformReadReceipts(a,c);g&&(h[k]=g[0])}if(k==null)return 0;else{g=b("MessengerServerPayloadTransformer.bs").transformDeliveryReceipts(c);if(g.length<1)return 0;else{c=b("bs_caml_array").caml_array_get(g,0);if(e.is_canonical){i.push({other_user_fbid:k,thread_fbid:null,time:b("bs_caml_format").caml_float_of_string(c.timestamp_precise)});return 0}else{i.push({other_user_fbid:null,thread_fbid:k,time:b("bs_caml_format").caml_float_of_string(c.timestamp_precise)});return 0}}}}},m.viewer.message_threads.nodes);q=m.viewer.message_threads.sync_sequence_id;q==null||(k[0]=b("bs_caml_format").caml_int_of_string(q));m=e.timestamp;g.push({start:e.offset,end:m==null?e.offset+e.limit|0:(e.offset+e.limit|0)-1|0,folder:e.folder,other_user_fbids:n,thread_fbids:o,thread_ids:p,filter:e.filter});return 0},e);return{threads:f,ordered_threadlists:g,pending_folder_unseen_count:l[0],roger:h,delivery_receipts:i,participants:b("bs_js_dict").values(j),sequence_id:k[0]}}function a(a,c,d,e){var f=b("bs_array").map(g,c);return b("Promise").all(b("WebGraphQL").execAll(f,{actorID:d?a:null,batchName:"MessengerGraphQLThreadlistFetcher"}))["catch"](function(a){b("BanzaiODS").bumpEntityKey("messenger_webgraphql",e+".failure");return b("Promise").reject(a)}).then(function(f){b("BanzaiODS").bumpEntityKey("messenger_webgraphql",e+".success");return h(a,c,d,f)})}f._getQuery=g;f.transform=h;f.fetchAll=a}),null);