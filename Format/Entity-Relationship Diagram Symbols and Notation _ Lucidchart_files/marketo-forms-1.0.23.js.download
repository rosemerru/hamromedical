"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),loadStates={NOT_LOADED:0,REQUESTED:1,LOADED:2},MktoUtils={siblings:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Array.prototype.filter.call(t.parentNode.children,function(o){return e?o!==t&&o.classList.contains(e):o!==t})}},FormController=function(){function t(){_classCallCheck(this,t),this.queued=[],this.pending=[],this.loaded=[],this.formCount=0,this.modalFormCount=0,this.scriptLoaded=loadStates.NOT_LOADED,this.styleLoaded=loadStates.NOT_LOADED,this.url="//app-ab23.marketo.com",this.stylesheet="https://d2slcw3kip6qmk.cloudfront.net/marketing/marketo/marketo-forms-1.0.6.css",this.extraStyles=[],this.forcedOptions={},this.forcedModalOptions={},this.forcedInlineOptions={},this.globalOnSuccess=null}return _createClass(t,[{key:"addForm",value:function(t){for(var e in this.forcedOptions)t[e]=this.forcedOptions[e];if(t.modal)for(var o in this.forcedModalOptions)t[o]=this.forcedModalOptions[o];if(!t.modal)for(var n in this.forcedInlineOptions)t[n]=this.forcedInlineOptions[n];var i=void 0;if(t.modal&&t.abTest){for(var s in t.abTest.branches)if(t.abTest.branches.hasOwnProperty(s)){t.id=t.abTest.branches[s],t.branch=s;var a=new Form(this,t);this.queued.push(a)}}else{if(t.abTest){var r=abTest(t.abTest.name);t.id=t.abTest.branches[r]}i=new Form(this,t),this.queued.push(i)}return this.formCount++,t.modal&&this.modalFormCount++,this._ready()?this._loadNextForm():(this.scriptLoaded===loadStates.NOT_LOADED&&this._loadMarketoScript(),this.styleLoaded===loadStates.NOT_LOADED&&this._loadFormStyles()),i}},{key:"formLoaded",value:function(t){this.pending.slice(this.pending.indexOf(t),1),this.loaded.push(t),this._loadNextForm()}},{key:"_loadNextForm",value:function(){if(this._ready()&&this.queued.length>0){var t=this.queued.shift();t.loadForm(),this.pending.push(t)}}},{key:"_ready",value:function(){return this.styleLoaded===loadStates.LOADED&&this.scriptLoaded===loadStates.LOADED}},{key:"_loadMarketoScript",value:function(){var t=this;this.scriptLoaded=loadStates.REQUESTED;var e=document.createElement("script");e.type="text/javascript",e.src=this.url+"/js/forms2/js/forms2.min.js",e.addEventListener("load",function(){t.scriptLoaded=loadStates.LOADED,t._loadNextForm()}),document.body.appendChild(e)}},{key:"_loadFormStyles",value:function(){var t=this;this.styleLoaded=loadStates.REQUESTED,this._addStylesheet(this.stylesheet,function(){t.styleLoaded=loadStates.LOADED,t._loadNextForm()}),this.extraStyles.forEach(function(e){t._addStylesheet(e)})}},{key:"_addStylesheet",value:function(t,e){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("href",t),e&&o.addEventListener("load",e),document.head.appendChild(o)}}]),t}(),Form=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,t),!o.hasOwnProperty("id"))return void console.error("Must provide a valid Marketo Form ID");this.controller=e;var n={abTest:null,buttonText:null,capterra:this._getCapterraSettings(),capterraPixel:!1,confirm:{heading:"Thank You",body:""},hideText:!1,kmRecordSubmission:!0,onSubmit:null,onSuccess:null,onValidate:null,modal:!1,onModalOpen:null,onInit:null,modalTriggerClass:"mkto-modal",modalWrapperId:"mkto-form-modal",munchkinId:"805-PTZ-019",padded:!0,redirect:null,replaceLabels:null,target:"mkto-form",theme:"light",topText:null,transparentBG:!1,twoColumns:!1};this.options=Object.assign({},n,o),this._render()}return _createClass(t,[{key:"_render",value:function(){var t=this,e=void 0;this.options.modal?(this.options.theme="dark-underline"===this.options.theme?this.options.theme:"dark",document.body.addEventListener("click",function(e){e.target.classList.contains(t.options.modalTriggerClass)&&t._openModal(e)}),e=this._createModalElement(),document.body.appendChild(e)):e=document.getElementById(this.options.target),this._createFormElement(e)}},{key:"loadForm",value:function(){var t=this;this.formEl.id=this.formEl.dataset.id,"undefined"!=typeof MktoForms2&&MktoForms2.loadForm(this.controller.url,this.options.munchkinId,this.options.id,function(e){t.formEl.id="",t._addHiddenFields(e),t._stripStyles(e),t._findCheckboxes(e),t.options.hideText?t._removeWYSIWYG(e):null!==t.options.topText&&(t._removeWYSIWYG(e),t._addTopText()),t.options.buttonText&&t._overrideButtonText(e),t.options.twoColumns&&(t._fixTwoColumnWYSIWYGText(e),t._fixTwoColumnTextAreas(e),t._fixMarketoTwoColumn(e)),"left"!==t.options.buttonAlign&&t._addButtonAlignment(e),t.options.replaceLabels&&t._replaceLabels(e,t.options.replaceLabels),t.options.onValidate&&e.onValidate(t.options.onValidate),t.options.onSubmit&&e.onSubmit(t.options.onSubmit),t.options.onInit&&t.options.onInit(e),e.onSuccess(function(e,o){if(t.options.capterraPixel&&t._fireCapterraPixel(),t.options.kmRecordSubmission&&t._kmRecordSubmission(),t.controller.globalOnSuccess)try{"function"==typeof t.controller.globalOnSuccess&&t.controller.globalOnSuccess(t)}catch(n){console.error("Error in globalOnSuccess",n)}return t.options.onSuccess&&t.options.onSuccess(e,o),t.options.redirect?(window.location=t.options.redirect,!1):(t._sizeConfirm(),t.formEl.style.display="none",t.options.confirm.element.style.display="flex",!1)}),t.controller.formLoaded(t)})}},{key:"_kmRecordSubmission",value:function(){if(window._kmProxy){var t="/"===window.location.pathname?"homepage":window.location.pathname;window._kmProxy.push(["set",{"marketo form submitted from page":t}])}}},{key:"_reset",value:function(){this.formEl.style.display="",this.options.confirm.element.style.display=""}},{key:"_sizeConfirm",value:function(){this.options.confirm.element.style.minHeight=this.formEl.offsetHeight+"px"}},{key:"_addHiddenFields",value:function(t){t.addHiddenFields({Attribution_URL__c:window.location.href,Attribution_URL_Path__c:window.location.pathname})}},{key:"_stripStyles",value:function(t){var e=t.getFormElem(),o=e.css("width");e.attr("style","width: "+o)}},{key:"_removeWYSIWYG",value:function(t){var e=t.getFormElem().filter(".hide-text, .has-top-text");e.find(".mktoHtmlText").closest(".mktoFormRow:not(.mkto-checkbox)").remove()}},{key:"_replaceLabels",value:function(t,e){var o=t.getFormElem(),n=o.find(".mktoLabel"),i=function(t){e.hasOwnProperty(t)&&n.each(function(){var o=e[t];if(this.innerHTML.indexOf(t)>-1){var n=this.innerHTML.replace(t,o.label);if(this.innerHTML=n,o.placeholder)for(var i=MktoUtils.siblings(this,"mktoField"),s=0;s<i.length;s++)i[s].placeholder=o.placeholder}})};for(var s in e)i(s)}},{key:"_addTopText",value:function(){var t=document.createElement("div");if(t.classList.add("mkto-top-text"),this.options.topText.title){var e=document.createElement("h3");e.classList.add("mkto-top-title"),e.innerHTML=this.options.topText.title,t.appendChild(e)}if(this.options.topText.body&&(Array.isArray(this.options.topText.body)||(this.options.topText.body=[this.options.topText.body]),this.options.topText.body.forEach(function(e){var o=document.createElement("p");o.classList.add("mkto-top-body"),o.innerHTML=e,t.appendChild(o)})),this.options.topText.note){var o=document.createElement("p");o.classList.add("mkto-top-note"),o.innerHTML=this.options.topText.note,t.appendChild(o)}this.formEl.insertBefore(t,this.formEl.firstChild.nextSibling)}},{key:"_fixTwoColumnWYSIWYGText",value:function(t){var e=t.getFormElem().filter(".mkto-two-columns");e.find(".mktoHtmlText").closest(".mktoFormRow").addClass("mkto-one-col")}},{key:"_fixTwoColumnTextAreas",value:function(t){var e=t.getFormElem().filter(".mkto-two-columns");e.find("textarea").closest(".mktoFormRow").addClass("mkto-one-col").end().closest(".mktoFormCol").addClass("mkto-text-area")}},{key:"_fixMarketoTwoColumn",value:function(t){var e=t.getFormElem().filter(".mkto-two-columns");e.find(".mktoFormRow").each(function(){this.querySelectorAll(".mktoFormCol").length>1&&(this.className+=" mkto-two-col")})}},{key:"_findCheckboxes",value:function(t){var e=t.getFormElem();e.find('input[type="checkbox"]').closest(".mktoFormCol").addClass("mkto-checkbox-col").closest(".mktoFormRow").addClass("mkto-checkbox")}},{key:"_addButtonAlignment",value:function(t){var e=t.getFormElem().filter(".button-align-"+this.options.buttonAlign);e.find(".mktoButtonRow").addClass("mkto-"+this.options.buttonAlign)}},{key:"_overrideButtonText",value:function(t){var e=t.getFormElem().find("button");e.text(this.options.buttonText)}},{key:"_createFormElement",value:function(t){var e=document.createElement("form");e.setAttribute("data-id","mktoForm_"+this.options.id),e.classList.add(this.options.theme),this.options.twoColumns&&e.classList.add("mkto-two-columns"),this.options.hideText&&e.classList.add("hide-text"),this.options.topText&&e.classList.add("has-top-text"),this.options.buttonAlign&&e.classList.add("button-align-"+this.options.buttonAlign),this.options.transparentBG&&e.classList.add("mkto-transparent"),this.options.padded||e.classList.add("mkto-no-padding"),window.location.hostname.includes("press")&&e.classList.add("press"),this.options.modal&&e.appendChild(this._createModalCloseElement()),this.formEl=e,t.appendChild(e),this.options.redirect||this._createConfirmationMessage(t)}},{key:"_createConfirmationMessage",value:function(t){var e=document.createElement("div");e.style.display="none",e.classList.add("mkto-confirm-message"),window.location.hostname.includes("press")&&e.classList.add("press");var o=document.createElement("div"),n=document.createElement("h3");if(n.classList.add("mkto-confirm-heading"),n.innerHTML=this.options.confirm.heading,this.options.modal&&o.appendChild(this._createModalCloseElement()),o.appendChild(n),this.options.confirm.body){var i=document.createElement("p");i.classList.add("mkto-confirm-body"),i.innerHTML=this.options.confirm.body,o.appendChild(i)}e.appendChild(o),t.appendChild(e),this.options.confirm.element=e}},{key:"_createModalElement",value:function(){var t=this;this.options.modalWrapperId+="-"+this.controller.modalFormCount;var e=document.createElement("div");return e.id=this.options.abTest?this.options.modalWrapperId+("-"+this.options.branch):this.options.modalWrapperId,e.classList.add("mkto-form-modal"),e.addEventListener("click",function(e){t._closeModal(e)}),e}},{key:"_createModalCloseElement",value:function(){var t=this,e=document.createElement("span");return e.innerHTML="&times;",e.classList.add("mkto-modal-close"),e.addEventListener("click",function(e){t._closeModal(e)}),e}},{key:"_openModal",value:function(t){t.preventDefault(),document.body.classList.add("modal-open");var e=void 0;if(this.options.abTest){var o=abTest(this.options.abTest.name);this.options.assignedBranch=o,e=this.options.modalWrapperId+("-"+o)}else e=this.options.modalWrapperId;document.getElementById(e).classList.add("mkto-modal-open"),this.options.onModalOpen&&this.options.onModalOpen()}},{key:"_closeModal",value:function(t){if(t.target===t.currentTarget){var e=this.options.abTest?this.options.modalWrapperId+("-"+this.options.assignedBranch):this.options.modalWrapperId;document.body.classList.remove("modal-open"),document.getElementById(e).classList.remove("mkto-modal-open")}}},{key:"_getCapterraSettings",value:function(){var t={};return window.location.href.includes("lucidpress.com")?(t.vid="2108491",t.vkey="f204cde50d4e2a2bb8bceb5bed089180"):(t.vid="2093136",t.vkey="e0457ea733aa6420770640938cafe2b6"),t}},{key:"_fireCapterraPixel",value:function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//ct.capterra.com/capterra_tracker.js?vid="+this.options.capterra.vid+"&vkey="+this.options.capterra.vkey;var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}},{key:"_findElementWithAttribute",value:function(t,e,o){var n=document.getElementsByTagName(t),i=!0,s=!1,a=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var d=r.value;if(d.getAttribute(e)===o)return d}}catch(c){s=!0,a=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(s)throw a}}return!1}}]),t}();"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(o[s]=i[s])}return o});var MktoForm=new FormController;