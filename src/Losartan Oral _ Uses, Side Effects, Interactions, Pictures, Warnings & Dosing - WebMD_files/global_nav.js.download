/* repo: amd-modules/master@1.15.2-47-g7e6d3b8 - Package Version: 2.0.0 - 2018-05-07 05:38 pm - User:  */

define("global_nav/1/global_nav",["newsletter-hover/1/hover-newsletter-center-id","search/1/typeahead","appboy-web-sdk/1/appboy.min"],function(newsletter,typeahead,appboy){"use strict";var global_nav={loggedIn:"",currentUrl:"",appID:"",appboyDefaults:{prod:{apiKey:"6521dd83-4be0-45e1-a5ec-4fc06be8bb83"},dev:{apiKey:"24259a3f-c4cf-412a-ac0e-ee10ab9f230d"},options:{minimumIntervalBetweenTriggerActionsInSeconds:0,safariWebsitePushId:"web.com.webmd"}},init:function(){var _this=this;_this.loggedIn=webmd.cookie.exists("WBMD_AUTH"),_this.currentUrl=window.location.href,_this.appID=webmd.appid||1,require.config({paths:{"webmd.m.socialshareplugin":"socialshareplugin/2/webmd.m.socialshareplugin.min"}}),_this.initializeShareBar(),$(".global-nav-sign-in a").attr("href","https://member.webmd.com/signin?appid="+_this.appID+"&returl="+_this.currentUrl),$("#global-nav-search, #global-nav-sharebar-search").on("mousedown focus",function(){$(".global-nav-logo, .global-nav-upper-reg-links, .global-sharebar-container").addClass("global-nav-search-expanded")}).on("blur",function(){$(".global-nav-logo, .global-nav-upper-reg-links, .global-sharebar-container").removeClass("global-nav-search-expanded")}),_this.loggedIn&&$(".global-nav-right-container").addClass("logged-in"),webmd.url.getParam("fixed")&&$("body").addClass("fixed-nav"),webmd.url.getParam("progress")&&_this.initializeProgressBar(),window.s_business_reference&&"Tool - Slide Show"!==window.s_business_reference&&"Tool - RMQ"!==window.s_business_reference&&$(".global-nav-container").addClass("is-fixed"),_this.moveFeaturedTopics(),$("body").on("click",'[data-metrics-module="nl-mast"] a',function(e){e.preventDefault(),$(".global-nav-primary-mask").trigger("click"),newsletter.onDemand()}),typeahead.init("global-nav-search-form"),typeahead.init("global-nav-sharebar-search-form"),_this.initServiceWorker(),_this.initWebPush()},moveFeaturedTopics:function(){$(".global-nav-featured-topics").each(function(){var link=$(this).data("link");$('[data-metrics-module="'+link+'"]').find(".global-nav-megamenu-container .row:last-child").append($(this))})},initializeProgressBar:function(){var scrollable=$("body").height()/$(window).height()>=2,scrollBar='<div class="global-nav-progress-bar"></div>',position=$("body").scrollTop(),offset=$(window).height(),height=$("body").height();scrollable&&($(".global-nav-container").append(scrollBar),$(".global-nav-progress-bar").css("width",position/(height-offset)*100+"%"),$(window).scroll(function(){position=$("body").scrollTop(),height=$("body").height(),offset=$(window).height(),$(".global-nav-progress-bar").css("width",position/(height-offset)*100+"%")}))},initializeShareBar:function(){var _this=this,$container=$(".global-nav-container"),threshold=1100,template='<div class="global-sharebar-container"><div class="global-sharebar-wrapper"><div class="global-sharebar-plugin"></div><span class="share-title">{title}</span><div class="global-nav-subscribe" data-metrics-module="nl-mast"><a class="button" href="https://member.webmd.com/subscribe" data-metrics-type="ad-hoc" data-metrics-link="sub">Subscribe</a></div><div class="global-nav-search-container"><form id="global-nav-sharebar-search-form" action="/search/search_results/default.aspx" data-metrics-module="srch-bar" _lpchecked="1"><input required="" aria-label="Enter search terms" autocomplete="off" id="global-nav-sharebar-search" class="typeahead-search" type="text" name="query" placeholder="Search"><button aria-label="Search" type="submit" class="global-nav-search-submit" data-metrics-link="submit"></button><ul class="global-nav-search-list typeahead-output"></ul></form></div></div></div>';webmd.global_nav&&webmd.global_nav.disableSharebar===!0||($container.trigger("global-nav-sharebar-init-before"),$container.append(webmd.substitute(template,{title:$("meta[property='og:title']").attr("content")})),_this.initSocialShare(".global-sharebar-plugin"),$(window).scroll(function(){$(this).scrollTop()>threshold?$container.addClass("share-mode"):$container.removeClass("share-mode")}),setTimeout(function(){$(".global-sharebar-container *").on("focus",function(){$container.addClass("share-mode")}),$(".global-sharebar-container *").on("blur",function(){$container.removeClass("share-mode")})},500),$container.trigger("global-nav-sharebar-init-after"))},initSocialShare:function(container){require(["webmd.m.socialshareplugin","css!socialshareplugin/2/socialshareplugin.min.css"],function(socialshare){$(container).socialshareplugin({baseHtmlTmpl:"<div class='plugin plugin-socialshare' data-metrics-module='sharebar-m'></div>",shareOrder:["facebook","twitter","pinterest"]})})},initWebPush:function(){var _this=this,primHtml='<li class="global-nav-notif" data-context="nav" data-notif-count="0"></li>',shareHtml='<div class="global-nav-notif" data-context="share" data-notif-count="0"></div>';appboy?(webmd.appboy=appboy,_this.initSubscriptionCookie(),$(".global-nav-upper-reg-links").prepend(primHtml),$(".global-sharebar-container .global-nav-subscribe").before(shareHtml),$(".global-nav-notif").click(function(e){var context=$(e.target).data("context");_this.handlePushClick(context)})):webmd.debug("Appboy Web SDK not loaded")},initABsession:function(){var _this=this;webmd.appboy.initialize()||(webmd.debug("AB session started"),webmd.appboy.initialize(_this.getAppboyKeys().apiKey,_this.appboyDefaults.options),webmd.appboy.openSession(),webmd.appboy.changeUser(webmd.cookie.get("VisitorId")),_this.initMessages())},getAppboyKeys:function(){var _this=this;return""!==webmd.url.getEnv()||""!==webmd.url.getLifecycle()?_this.appboyDefaults.dev:_this.appboyDefaults.prod},initMessages:function(){var _this=this;webmd.appboy.subscribeToNewInAppMessages(function(inAppMessages){var message=inAppMessages[0];if(null!==message){var shouldDisplay=!0;if(message instanceof appboy.ab.InAppMessage){var msgId=message.extras["msg-id"];"push-primer"===msgId?null!==message.buttons[0]&&message.buttons[0].subscribeToClickedEvent(function(){_this.pushSubscribe()}):"push-unregister"===msgId&&null!==message.buttons[0]&&message.buttons[0].subscribeToClickedEvent(function(){_this.cancelPushSubscription()})}shouldDisplay&&appboy.display.showInAppMessage(message)}return inAppMessages.slice(1)})},handlePushClick:function(context){var _this=this;"false"===webmd.cookie.get("notif_on")?(_this.initABsession(),setTimeout(function(){webmd.appboy.isPushSupported()?webmd.appboy.logCustomEvent("prime-for-push"):webmd.appboy.logCustomEvent("push-unsupported"),_this.handleModal(context)},500)):(webmd.appboy.isPushPermissionGranted()?webmd.appboy.logCustomEvent("push-unregister"):webmd.appboy.logCustomEvent("prime-for-push"),_this.handleModal(context))},handleModal:function(context){var _this=this;"nav"===context?($(".ab-modal").addClass("notif-drawer"),_this.loggedIn&&$(".notif-drawer").addClass("logged-in")):$(".ab-modal").addClass("notif-drawer sharebar"),window.wmdPageLink("wp-hov")},pushSubscribe:function(){webmd.appboy.registerAppboyPushMessages(),webmd.cookie.set("notif_on","true",{expires:3650})},cancelPushSubscription:function(){webmd.appboy.unregisterAppboyPushMessages(),webmd.cookie.set("notif_on","false",{expires:3650})},initServiceWorker:function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(){webmd.debug("Service Worker Registered")})},initSubscriptionCookie:function(){var _this=this;webmd.cookie.exists("notif_on")?"true"===webmd.cookie.get("notif_on")&&_this.initABsession():webmd.cookie.set("notif_on","false",{expires:3650})}};return global_nav});